#!/bin/sh

dir=/org/ftp.debian.org/ftp/dists/woody/

for component in main non-free contrib; do # non-free contrib
  for i in $(find $dir/$component/binary-all/ -type f); do 
    new=$(find $dir/$component/binary-i386/ -type f -name $(basename $i | sed -e "s/_.*//")_\*);
    if [ ! -z "$new" ]; then 
      oldver=$(dpkg-deb -f $i version)
      newver=$(dpkg-deb -f $new version)
      if dpkg --compare-versions $oldver gt $newver; then
        echo EEH???
        echo $(basename $i) dominates $(basename $new) ???;
      fi;
      if dpkg --compare-versions $oldver eq $newver; then
        #echo $(basename $i) equals $(basename $new);
        true;
      fi;
      if dpkg --compare-versions $oldver lt $newver; then
        echo \# $(basename $new) \(arch: any\) DOMINATES $(basename $i) \(arch: all\);
        echo mv -iv $i ~troup/removed-from-ftp/all/
      fi;
    fi; 
  done
done

echo
echo \# Cleanup dangling symlinks
echo symlinks -rd $dir
